<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
	<div th:fragment="profile-fields">
		<script>
			htmx.config.historyEnabled = false;
		</script>

		<div th:fragment="profile-fields(role)">
			<!-- Студент -->
			<div th:if="${role==Role.STUDENT}" class="student-profile-section">
				<div class="form-group" style="position: relative;">
					<label for="universityInput">Университет</label>
					<input type="text" id="universityInput" name="profileDto.universityName" class="form-control"
						hx-get="/fragments/get-universities-by-input" hx-trigger="keyup changed delay:100ms"
						hx-target="#university-suggestions"
						hx-vals="js:{input: document.getElementById('universityInput').value}" autocomplete="off"
						placeholder="Название вашего университета" />
					<i class="fas fa-university"></i>
				</div>
				<div id="university-suggestions" style="position: relative;"></div>

				<div class="form-group" style="position: relative;">
					<label for="specialityInput">Специальность</label>
					<input type="text" id="specialityInput" name="profileDto.specialityCodeAndName" class="form-control"
						hx-get="/fragments/get-specialities-by-input" hx-trigger="keyup changed delay:100ms"
						hx-target="#speciality-suggestions" hx-vals="js:{input: document.getElementById('specialityInput').value,
                            universityName: document.getElementById('universityInput').value}" autocomplete="off"
						placeholder="Код (09.03.04) или название (Программная инженерия)" />
					<i class="fas fa-code"></i>
				</div>
				<div id="speciality-suggestions" style="position: relative;"></div>
				<input type="hidden" id="specialityCode" name="specialityCode">
				<input type="hidden" id="specialityName" name="specialityName">

				<div class="form-group">
					<label for="courseNum">Курс</label>
					<select name="profileDto.courseNum" id="courseNum" required>
						<option value="">Выберите курс</option>
						<option value="1">1 курс</option>
						<option value="2">2 курс</option>
						<option value="3">3 курс</option>
						<option value="4">4 курс</option>
						<option value="5">5 курс</option>
						<option value="6">6 курс</option>
					</select>
					<i class="fas fa-graduation-cap"></i>
				</div>

				<div class="form-group">
					<label for="studyType">Форма обучения</label>
					<select name="profileDto.studyType" id="studyType" required>
						<option th:each="t : ${studyTypes}" th:value="${t}" th:text="${t.displayValue}"></option>
					</select>
					<i class="fas fa-book-open"></i>
				</div>
			</div>

			<!-- Админ -->
			<div th:if="${role==Role.ADMIN}" class="admin-profile-section">
				<div class="form-group" style="position: relative;">
					<label for="organisationInput">Организация</label>
					<input type="text" id="organisationInput" name="profileDto.organisationName" class="form-control"
						hx-get="/fragments/get-organisations-by-input" hx-trigger="keyup changed delay:100ms"
						hx-target="#organisation-suggestions"
						hx-vals="js:{input: document.getElementById('organisationInput').value}" autocomplete="off"
						placeholder="Название вашей организации" />
					<i class="fas fa-university"></i>
				</div>
				<div id="organisation-suggestions" style="position: relative;"></div>
			</div>
		</div>
	</div>
	<div th:fragment="vacancies" hx-get="/vacancies/filter" hx-trigger="every 2s" hx-swap="outerHTML">
		<div th:if="${not #lists.isEmpty(vacancies)}">
			<div class="vacancy-card" th:each="vacancy : ${vacancies}">
				<div class="vacancy-header">
					<div>
						<h3 class="vacancy-title" th:text="${vacancy.position}"></h3>
						<div class="vacancy-company" th:text="${vacancy.organisation?.name}"></div>
					</div>
					<div class="vacancy-salary">
						<span th:if="${vacancy.minSalary != null and vacancy.maxSalary == null}">
							от <span th:text="${#numbers.formatInteger(vacancy.minSalary, 0, 'COMMA')}"></span> руб.
						</span>
						<span th:if="${vacancy.minSalary == null and vacancy.maxSalary != null}">
							до <span th:text="${#numbers.formatInteger(vacancy.maxSalary, 0, 'COMMA')}"></span> руб.
						</span>
						<span th:if="${vacancy.minSalary != null and vacancy.maxSalary != null
							 and vacancy.minSalary != vacancy.maxSalary}">
							<span th:text="${#numbers.formatInteger(vacancy.minSalary, 0, 'COMMA')}"></span> -
							<span th:text="${#numbers.formatInteger(vacancy.maxSalary, 0, 'COMMA')}"></span> руб.
						</span>
						<span th:if="${vacancy.minSalary != null and vacancy.maxSalary != null 
							and vacancy.minSalary == vacancy.maxSalary}">
							<span th:text="${#numbers.formatInteger(vacancy.minSalary, 0, 'COMMA')}"></span> руб.
						</span>
						<span th:if="${vacancy.minSalary == null and vacancy.maxSalary == null}">
							Зарплата не указана
						</span>
					</div>
				</div>

				<div class="vacancy-info">
					<div class="vacancy-meta">
						<i class="fas fa-briefcase"></i>
						<span th:text="${vacancy.schedule}"></span>
					</div>
				</div>

				<div class="vacancy-description" th:text="${vacancy.description}"></div>

				<div class="vacancy-actions"
					th:insert="~{_fragments :: btn-apply(${vacancy.id}, ${vacancy.hasCurrentStudentResponse})}"></div>
			</div>
		</div>

		<div th:if="${#lists.isEmpty(vacancies)}" class="no-vacancies">
			<p th:if="${param.search != null or param.minSalary != null or param.maxSalary != null 
	                   or (param.orgIds != null and not param.orgIds.isEmpty()) 
	                   or (param.schedules != null and not param.schedules.isEmpty())}">
				По вашему запросу вакансии не найдены.
			</p>
			<p th:unless="${param.search != null or param.minSalary != null or param.maxSalary != null 
	                     or (param.orgIds != null and not param.orgIds.isEmpty()) 
	                     or (param.schedules != null and not param.schedules.isEmpty())}">
				На данный момент нет доступных вакансий для вашего университета.
			</p>
		</div>
	</div>
	 <div th:fragment="vacancies-hr">
        <div th:if="${not #lists.isEmpty(vacancies)}">
            <div class="vacancy-card" th:each="vacancy : ${vacancies}">
                <div class="vacancy-header">
                    <div>
                        <h3 class="vacancy-title" th:text="${vacancy.position}"></h3>
                        <div class="vacancy-company" th:text="${vacancy.organisation?.name}"></div>
                    </div>
                    <div class="vacancy-salary">
                        <span th:if="${vacancy.minSalary != null and vacancy.maxSalary == null}">
                            от <span th:text="${#numbers.formatInteger(vacancy.minSalary, 0, 'COMMA')}"></span> руб.
                        </span>
                        <span th:if="${vacancy.minSalary == null and vacancy.maxSalary != null}">
                            до <span th:text="${#numbers.formatInteger(vacancy.maxSalary, 0, 'COMMA')}"></span> руб.
                        </span>
                        <span th:if="${vacancy.minSalary != null and vacancy.maxSalary != null
                             and vacancy.minSalary != vacancy.maxSalary}">
                            <span th:text="${#numbers.formatInteger(vacancy.minSalary, 0, 'COMMA')}"></span> -
                            <span th:text="${#numbers.formatInteger(vacancy.maxSalary, 0, 'COMMA')}"></span> руб.
                        </span>
                        <span th:if="${vacancy.minSalary != null and vacancy.maxSalary != null 
                            and vacancy.minSalary == vacancy.maxSalary}">
                            <span th:text="${#numbers.formatInteger(vacancy.minSalary, 0, 'COMMA')}"></span> руб.
                        </span>
                        <span th:if="${vacancy.minSalary == null and vacancy.maxSalary == null}">
                            Зарплата не указана
                        </span>
                    </div>
                </div>

                <div class="vacancy-info">
                    <div class="vacancy-meta">
                        <i class="fas fa-briefcase"></i>
                        <span th:text="${vacancy.schedule}"></span>
                    </div>
                </div>

                <div class="vacancy-description" th:text="${vacancy.description}"></div>
                
                <div class="vacancy-actions-admin">
                    <a th:href="@{/vacancies/{id}/edit(id=${vacancy.id})}" class="search-button">
                        <i class="fas fa-edit"></i> Редактировать
                    </a>
                    <button th:hx-get="|/${vacancy.id}/delete|" hx-swap="outerHTML" hx-target="closest .vacancy-card" class="search-button">
                        <i class="fas fa-trash"></i> Удалить
                    </button>
                    <a th:href="@{/vacancies/{id}/responses(id=${vacancy.id})}" class="search-button">
                        <i class="fas fa-eye"></i> Посмотреть отклики
                    </a>
                </div>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(vacancies)}" class="no-vacancies">
            <div class="empty-state">
                <i class="fas fa-briefcase fa-3x"></i>
                <h3>У вас пока нет вакансий</h3>
                <p>Создайте первую вакансию, чтобы начать</p>
            </div>
        </div>
    </div>
	<div th:fragment="btn-apply(vacancyId, hasCurrentStudentResponse)">
		<button class="apply-button"
			th:attr="data-vacancy-id=${vacancyId}, hx-get=${'/vacancies/' + vacancyId + '/response'}" hx-target="this"
			hx-swap="outerHTML">
			<div th:if="${hasCurrentStudentResponse}">
				<i class="fas fa-check"></i>
				Отклик отправлен
			</div>
			<div th:unless="${hasCurrentStudentResponse}">Откликнуться</div>
		</button>
	</div>
	<div th:fragment="vacancy-form-fields(vacancy)">
        <div class="form-row">
            <div class="form-group">
                <label for="position">Должность *</label>
                <div class="input-with-icon center-input">
                    <input type="text" 
                           id="position"
                           th:field="*{position}"
                           placeholder="Например: Frontend-разработчик"
                           required
                           maxlength="255">
                    <i class="fas fa-briefcase"></i>
                </div>
            </div>
        </div>
        
        <!-- Зарплата -->
        <div class="form-row">
            <div class="form-group">
                <label for="minSalary">Минимальная зарплата</label>
                <div class="input-with-icon">
                    <input type="number" 
                           id="minSalary"
                           th:field="*{minSalary}"
                           placeholder="50000"
                           min="0">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <small class="form-hint">В рублях, оставьте пустым если не указано</small>
            </div>
            
            <div class="form-group">
                <label for="maxSalary">Максимальная зарплата</label>
                <div class="input-with-icon">
                    <input type="number" 
                           id="maxSalary"
                           th:field="*{maxSalary}"
                           placeholder="150000"
                           min="0">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <small class="form-hint">В рублях, оставьте пустым если не указано</small>
            </div>
        </div>
        
        <!-- График работы -->
        <div class="form-group">
            <label for="schedule">График работы *</label>
            <div class="input-with-icon">
                <select id="schedule" th:field="*{schedule}" required>
                    <option value="" disabled>Выберите график работы</option>
                    <option value="Полная занятость">Полная занятость</option>
                    <option value="Частичная занятость">Частичная занятость</option>
                    <option value="Стажировка">Стажировка</option>
                    <option value="Удаленная работа">Удаленная работа</option>
                    <option value="Гибкий график">Гибкий график</option>
                </select>
                <i class="fas fa-calendar-alt"></i>
            </div>
        </div>
        
        <!-- Описание -->
        <div class="form-group">
            <label for="description">Описание вакансии *</label>
            <div class="textarea-with-icon">
                <textarea id="description"
                          th:field="*{description}"
                          placeholder="Опишите вакансию: обязанности, требования, условия работы..."
                          required
                          rows="8"></textarea>
            </div>
            <small class="form-hint">Подробно опишите вакансию, чтобы привлечь подходящих кандидатов</small>
        </div>
    </div>
</body>

</html>