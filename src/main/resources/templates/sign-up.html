<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>–°—Ç—É–¥–≤–æ—Ä–∫ - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" th:href="@{css/style.css}" href="../static/css/style.css">
	<script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body>
	<header>
		<div class="container">
			<div class="header-top">
				<div class="logo">
					<a th:href="@{/sign-in}" href="/" class="logo-link">
						<div class="logo-wrapper">
							<img th:src="@{/images/studwork.png}" src="../static/images/studwork.png" alt="–°—Ç—É–¥–í–æ—Ä–∫"
								class="logo-image">
						</div>
						<span>–°—Ç—É–¥–≤–æ—Ä–∫</span>
					</a>
				</div>
			</div>
		</div>
	</header>
	<main class="main-content">
		<div class="auth-container">
			<h2 class="auth-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
			<form class="auth-form" th:action="@{/sign-up}" th:object="${signUpDto}" method="post">
				<div class="form-group">
					<label for="email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
					<input type="email" th:field="*{userDto.email}" id="email" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email" required>
					<i class="fas fa-envelope"></i>
				</div>
<div class="form-group">
    <label for="password">–ü–∞—Ä–æ–ª—å</label>
    <div class="password-wrapper">
        <input type="password" th:field="*{userDto.password}" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        <i class="fas fa-lock"></i>
        <button type="button" class="password-toggle" data-target="password">
            <i class="fas fa-eye"></i>
        </button>
    </div>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
</div>

<div class="form-group">
    <label for="password2">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
    <div class="password-wrapper">
        <input type="password" th:field="*{userDto.password2}" id="password2" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        <i class="fas fa-lock"></i>
        <button type="button" class="password-toggle" data-target="password2">
            <i class="fas fa-eye"></i>
        </button>
    </div>
    <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É -->
    <div id="password-match-container"></div>
</div>
				<div class="form-group">
					<label for="name">–ò–º—è</label>
					<input type="text" th:field="*{userDto.name}" id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
					<i class="fas fa-user"></i>
				</div>

				<div class="form-group">
					<label for="surname">–§–∞–º–∏–ª–∏—è</label>
					<input type="text" th:field="*{userDto.surname}" id="surname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é" required>
					<i class="fas fa-user"></i>
				</div>

				<div class="form-group">
					<label for="lastName">–û—Ç—á–µ—Å—Ç–≤–æ</label>
					<input type="text" th:field="*{userDto.lastName}" id="lastName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ">
					<i class="fas fa-user"></i>
				</div>

				<div class="form-group">
					<label for="birthDate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
					<input type="date" th:field="*{userDto.birthDate}" id="birth_date" required>
					<i class="fas fa-calendar"></i>
				</div>

				<div class="form-group">
					<label for="sex">–ü–æ–ª</label>
					<select th:field="*{userDto.sex}" id="sex" required>
						<option th:each="s: ${sexes}" th:value="${s}" th:text="${s.displayValue}"></option>
					</select>
					<i class="fas fa-venus-mars"></i>
				</div>

				<div class="form-group">
					<label for="role">–†–æ–ª—å</label>
					<select id="role" name="userDto.role" required onchange="loadProfileFields(this.value)">
						<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
						<option value="STUDENT">–°—Ç—É–¥–µ–Ω—Ç</option>
						<option value="ADMIN">–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å</option>
					</select>
					<i class="fas fa-user-tag"></i>
				</div>

				<div id="profile-fields-container"></div>

				<div th:if="${successMessage}" class="alert alert-success">
					<i class="fas fa-check-circle"></i>
					<span th:text="${successMessage}"></span>
				</div>

				<div th:if="${errorMessage}" class="alert alert-error">
					<i class="fas fa-exclamation-circle"></i>
					<span th:text="${errorMessage}"></span>
				</div>

				<button type="submit" class="auth-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>

				<div class="auth-links">
					<a href="#"><i class="fas fa-shield-alt"></i> –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
					<a href="#"><i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å</a>
				</div>
			</form>

			<div class="divider">
				<span>–∏–ª–∏</span>
			</div>

			<p style="margin-bottom: 20px; text-align: center;">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</p>
			<button class="register-button" th:onclick="'location.href=\'' + @{/sign-in} + '\''"
				onclick="window.location.href='enter.html'">
				–í–æ–π—Ç–∏
			</button>
		</div>
	</main>
	
	<footer>
		<div class="container">
			<div class="footer-content">
				<div class="footer-column">
					<h3>–°–æ–∏—Å–∫–∞—Ç–µ–ª—è–º</h3>
					<ul>
						<li><a href="#"><i class="fas fa-briefcase"></i> –í–∞–∫–∞–Ω—Å–∏–∏</a></li>
						<li><a href="#"><i class="fas fa-graduation-cap"></i> –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∏</a></li>
						<li><a href="#"><i class="fas fa-file-alt"></i> –ö–∞–∫ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∑—é–º–µ</a></li>
						<li><a href="#"><i class="fas fa-comments"></i> –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é</a></li>
					</ul>
				</div>

				<div class="footer-column">
					<h3>–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è–º</h3>
					<ul>
						<li><a href="#"><i class="fas fa-plus-circle"></i> –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π</a></li>
						<li><a href="#"><i class="fas fa-calendar-alt"></i> –Ø—Ä–º–∞—Ä–∫–∏ –≤–∞–∫–∞–Ω—Å–∏–π</a></li>
						<li><a href="#"><i class="fas fa-handshake"></i> –°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –≤—É–∑–æ–º</a></li>
					</ul>
				</div>

				<div class="footer-column">
					<h3>–û –ø—Ä–æ–µ–∫—Ç–µ</h3>
					<ul>
						<li><a href="#"><i class="fas fa-info-circle"></i> –û –°—Ç—É–¥–≤–æ—Ä–∫</a></li>
						<li><a href="#"><i class="fas fa-phone"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
						<li><a href="#"><i class="fas fa-life-ring"></i> –ü–æ–º–æ—â—å</a></li>
						<li><a href="#"><i class="fas fa-question-circle"></i> –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</a></li>
					</ul>
				</div>

				<div class="footer-column">
					<h3>–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</h3>
					<div class="social-links">
						<a href="#"><i class="fab fa-vk"></i></a>
						<a href="#"><i class="fab fa-telegram"></i></a>
						<a href="#"><i class="fab fa-youtube"></i></a>
					</div>
				</div>
			</div>

			<div class="copyright">
				¬© 2025 –°—Ç—É–¥–í–æ—Ä–∫ - –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
			</div>
		</div>
	</footer>
	<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
function togglePasswordVisibility(button) {
    const targetId = button.getAttribute('data-target');
    const passwordField = document.getElementById(targetId);
    const icon = button.querySelector('i');
    
    if (passwordField) {
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passwordField.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
function initPasswordToggles() {
    const toggleButtons = document.querySelectorAll('.password-toggle');
    toggleButtons.forEach(button => {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
        button.replaceWith(button.cloneNode(true));
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–Ω–æ–≤–æ
    document.querySelectorAll('.password-toggle').forEach(button => {
        button.addEventListener('click', function() {
            togglePasswordVisibility(this);
        });
    });
}

// –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–î –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô...
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ ML –º–æ–¥–µ–ª—å
async function checkPasswordStrength(password) {
    if (!password) return null;
    
    try {
        const response = await fetch('/api/password/check?password=' + encodeURIComponent(password));
        if (response.ok) {
            return await response.json();
        }
        return null;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è:', error);
        return null;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
function updatePasswordStrengthIndicator(strengthData) {
    let container = document.getElementById('password-strength-container');
    
    if (!container) {
        container = document.createElement('div');
        container.id = 'password-strength-container';
        container.className = 'password-strength-container';
        
        const passwordGroup = document.getElementById('password').closest('.form-group');
        passwordGroup.appendChild(container);
    }
    
    let indicator = document.getElementById('password-strength-indicator');
    
    if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'password-strength-indicator';
        indicator.className = 'password-strength-indicator';
        container.appendChild(indicator);
    }
    
    if (!strengthData || strengthData.strength === 'error') {
        indicator.innerHTML = '<div class="strength-unknown">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏...</div>';
        return;
    }
    
    const strength = strengthData.strength;
    const confidence = Math.round(strengthData.confidence * 100);
    const weakProb = Math.round(strengthData.weakProbability * 100);
    const mediumProb = Math.round(strengthData.mediumProbability * 100);
    const strongProb = Math.round(strengthData.strongProbability * 100);
    
    let strengthText, strengthClass, strengthColor;
    
    switch (strength) {
        case 'weak':
            strengthText = 'üî¥ –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å';
            strengthClass = 'strength-weak';
            strengthColor = '#dc3545';
            break;
        case 'medium':
            strengthText = 'üü° –°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–æ–ª—å';
            strengthClass = 'strength-medium';
            strengthColor = '#ffc107';
            break;
        case 'strong':
            strengthText = 'üü¢ –°–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å';
            strengthClass = 'strength-strong';
            strengthColor = '#28a745';
            break;
        default:
            strengthText = '‚ö™ –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            strengthClass = 'strength-unknown';
            strengthColor = '#6c757d';
    }
    
    indicator.innerHTML = `
        <div class="strength-bar ${strengthClass}">
            <div class="strength-label">
                <span class="strength-text">${strengthText}</span>
                <span class="strength-confidence">${confidence}% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</span>
            </div>
            <div class="strength-visual">
                <div class="strength-fill" style="width: ${confidence}%; background-color: ${strengthColor};"></div>
            </div>
            <div class="strength-details">
                <span class="strength-probability prob-weak">–°–ª–∞–±—ã–π: ${weakProb}%</span>
                <span class="strength-probability prob-medium">–°—Ä–µ–¥–Ω–∏–π: ${mediumProb}%</span>
                <span class="strength-probability prob-strong">–°–∏–ª—å–Ω—ã–π: ${strongProb}%</span>
            </div>
        </div>
    `;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
function validatePasswordMatch() {
    const password = document.getElementById('password')?.value;
    const password2 = document.getElementById('password2')?.value;
    const container = document.getElementById('password-strength-container');
    
    let matchIndicator = document.getElementById('password-match-indicator');
    
    if (!matchIndicator && container) {
        matchIndicator = document.createElement('div');
        matchIndicator.id = 'password-match-indicator';
        matchIndicator.className = 'password-match-indicator';
        container.appendChild(matchIndicator);
    }
    
    if (!matchIndicator) return true;
    
    if (!password2) {
        matchIndicator.innerHTML = '';
        return true;
    }
    
    if (password === password2) {
        matchIndicator.innerHTML = '<div class="match-success"><i class="fas fa-check-circle"></i> –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç</div>';
        return true;
    } else {
        matchIndicator.innerHTML = '<div class="match-error"><i class="fas fa-exclamation-circle"></i> –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</div>';
        return false;
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
function initPasswordValidation() {
    const passwordInput = document.getElementById('password');
    const password2Input = document.getElementById('password2');
    
    if (!passwordInput) return;
    
    // –î–µ–±–∞—É–Ω—Å –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    let passwordTimeout;
    passwordInput.addEventListener('input', function() {
        clearTimeout(passwordTimeout);
        passwordTimeout = setTimeout(async () => {
            const strengthData = await checkPasswordStrength(this.value);
            updatePasswordStrengthIndicator(strengthData);
        }, 500);
        
        setTimeout(validatePasswordMatch, 100);
    });
    
    if (password2Input) {
        password2Input.addEventListener('input', function() {
            setTimeout(validatePasswordMatch, 100);
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    initPasswordToggles();
    initPasswordValidation();
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
document.querySelector('.auth-form')?.addEventListener('submit', async function(event) {
    const password = document.getElementById('password')?.value;
    const password2 = document.getElementById('password2')?.value;
    
    if (password && password2) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
        if (!validatePasswordMatch()) {
            event.preventDefault();
            alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
            return;
        }
        
        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è
        const strengthData = await checkPasswordStrength(password);
        if (strengthData && strengthData.strength === 'weak') {
            const proceed = confirm('–í–∞—à –ø–∞—Ä–æ–ª—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å–ª–∞–±—ã–π. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é?');
            if (!proceed) {
                event.preventDefault();
                return;
            }
        }
    }
});

// –£–î–ê–õ–ò–¢–ï –≠–¢–£ –ß–ê–°–¢–¨ –ö–û–î–ê - –û–ù–ê –î–£–ë–õ–ò–†–£–ï–¢–°–Ø
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// document.addEventListener('DOMContentLoaded', function() {
//     initPasswordToggles();
//     ...
// });
</script>

</body>
</html>